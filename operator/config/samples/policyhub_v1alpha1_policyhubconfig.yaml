---
# =============================================================================
# BOOTSTRAP MODE (Recommended)
# =============================================================================
# Use this mode for new installations. The operator will automatically
# register with Policy Hub and create the cluster connection.
# =============================================================================
apiVersion: policyhub.io/v1alpha1
kind: PolicyHubConfig
metadata:
  name: policy-hub-config
  namespace: policy-hub-system
spec:
  # URL of your Policy Hub SaaS platform
  saasEndpoint: https://policy-hub.example.com

  # Cluster name for registration (shown in Policy Hub UI)
  clusterName: my-production-cluster

  # Reference to the secret containing your registration token
  # Get this from Policy Hub UI: Clusters > Registration Tokens > Create Token
  registrationTokenSecretRef:
    name: policy-hub-registration
    key: registration-token

  # How often to sync policies (default: 30s)
  syncInterval: 30s

  # How often to send heartbeats (default: 60s)
  heartbeatInterval: 60s

  # Optional: Cluster metadata
  provider: AWS     # AWS, GCP, AZURE, ON_PREM, OTHER
  region: us-east-1
  environment: PRODUCTION  # DEVELOPMENT, STAGING, PRODUCTION, TESTING

  # Optional: Hubble flow collection settings
  flowCollection:
    enabled: true
    hubbleAddress: hubble-relay.kube-system.svc.cluster.local:4245
    batchSize: 500
    flushInterval: 10s

  # Optional: Limit policy deployment to specific namespaces
  # Leave empty for all namespaces
  targetNamespaces: []
---
# Secret containing the registration token (for bootstrap mode)
apiVersion: v1
kind: Secret
metadata:
  name: policy-hub-registration
  namespace: policy-hub-system
type: Opaque
stringData:
  registration-token: phub_your-registration-token-here

---
# =============================================================================
# LEGACY MODE (For existing clusters)
# =============================================================================
# Use this mode if you already have a cluster created in Policy Hub and
# have a cluster-specific API token.
# =============================================================================
# apiVersion: policyhub.io/v1alpha1
# kind: PolicyHubConfig
# metadata:
#   name: policy-hub-config
#   namespace: policy-hub-system
# spec:
#   saasEndpoint: https://policy-hub.example.com
#   clusterId: clxxxxxxxxxxxxxxxx
#   apiTokenSecretRef:
#     name: policy-hub-operator
#     key: api-token
#   syncInterval: 30s
#   heartbeatInterval: 60s
# ---
# apiVersion: v1
# kind: Secret
# metadata:
#   name: policy-hub-operator
#   namespace: policy-hub-system
# type: Opaque
# stringData:
#   api-token: phub_your-cluster-specific-token-here
